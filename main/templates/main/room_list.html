{% extends 'main/base.html' %}

{% load static %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/main.css' %}"/>
{% endblock css %}

{% block left %}
    <button class="tab-button tab-on"><h2 class="medium-futura">Rooms</h2></button>
    <button class="tab-button"><h2 class="medium-futura">Chats</h2></button>
{% endblock left %}

{% block content %}
    <div class="content-back">
        <div class="tab-box">
            <button id="new-room-button" onclick="location.href='{% url 'main_room_create' %}'" class="primary-border-button medium-futura">+</button>
            {% for room in rooms %}
                <div class="room-wrapper">
                    <div class="room-header-wrapper">
                        {% if room.get_status_display == "Waiting" %}
                            <div class="room-status-wrapper status-waiting">대기중</div>
                        {% else %}
                            <div class="room-status-wrapper status-in-game">게임중</div>
                        {% endif %}
                        <div class="room-title-wrapper">{{ room.title }}</div>
                    </div>
                    <div class="room-game-wrapper">{{ room.get_game_display }} - 1 / 5</div>
                    {% if room.get_status_display == "Waiting" %}
                        <button class="room-button primary-button">입장</button>
                    {% else %}
                        <button class="room-button primary-light-button">관전</button>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="tab-box" style="display: none">
            <div class="text-center content-title">
                <h3>Chat Room - 대기실</h3>
            </div>
            <div id="chat-box">
                <p v-for="chat in chats">
                    <a>[[ chat.user ]]: </a>[[ chat.message ]]
                </p>
            </div>
            <form onsubmit="return chat_send();" id="chat-input-form">
                <input id="chat-message" type="text" placeholder="메시지를 입력하세요." autocomplete="off">
                <button class="primary-button">전송</button>
            </form>
        </div>
    </div>
{% endblock content %}

{% block script %}
    <script>
        let chat_box = new Vue({
            delimiters: ['[[', ']]'],
            el: '#chat-box',
            data: {
                chats: [
                    {user: '김민재', message: '메시지 메시지'},
                    {user: '땡떙', message: '도레미파솔라시도'},
                ]
            }
        });

        const chat_message = document.getElementById('chat-message');

        let user_name;
        {% if user.is_authenticated %}
            user_name = '{{ user.first_name }}';
        {% else %}
            user_name = '익명' + (Math.floor(Math.random()*8999) + 1000).toString();
        {% endif %}

        chat_send = () => {
            chat_box.chats.push({
                user: user_name,
                message: chat_message.value
            });

            chat_message.value = '';
            return false;
        };
    </script>
{% endblock script %}